<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="cn.edu.imut.jm.journal.domain.borrow.dao.JournalBorrowDao">
	<resultMap id="BorrowMap"
		type="cn.edu.imut.jm.journal.domain.borrow.entity.Borrow">
		<id column="borrow_id" property="borrowId" jdbcType="INTEGER" />
		<result column="borrow_time" property="borrowTime"
			jdbcType="DATE" />
		<result column="return_time" property="returnTime"
			jdbcType="DATE" />
		<result column="reality_days" property="realityDays"
			jdbcType="INTEGER" />
		<result column="is_overdue" property="isOverdue"
			jdbcType="TINYINT" />
		<result column="overdue_days" property="overdueDays"
			jdbcType="INTEGER" />
		<result column="penalty" property="penalty" jdbcType="DECIMAL" />
		<result column="is_payment" property="isPayment"
			jdbcType="TINYINT" />
		<result column="is_delete" property="isDelete"
			jdbcType="TINYINT" />
		<result column="user_id" property="userId" jdbcType="INTEGER" />
		<result column="journal_id" property="journalId"
			jdbcType="INTEGER" />
	</resultMap>
	<resultMap
		type="cn.edu.imut.jm.journal.domain.borrow.valobj.BorrowVo"
		id="BorrowVoMap" extends="BorrowMap">
		<association property="journalDetails"
			column="journal_id"
			javaType="cn.edu.imut.jm.journal.domain.journal.entity.JournalDetails"
			select="selectJournal"></association>
	</resultMap>
	<sql id="Borrow_Column_List">
		borrow_id, borrow_time, return_time, reality_days, is_overdue, overdue_days,
		penalty,
		is_payment, is_delete, user_id, journal_id
	</sql>
	<select id="selectByUserId" resultMap="BorrowVoMap">
		select
		<include refid="Borrow_Column_List" />
		from borrow
		<where>
			user_id = #{userId,jdbcType=INTEGER} 
			<if test="isOverdue=='1'.toString()">
			and return_time &lt;= NOW()
			</if>
			<if test="isOverdue=='0'.toString()">
			and return_time &gt; NOW()
			</if>
			<if test="isPayment=='1'.toString()">
			and is_payment =1
			</if>
			<if test="isPayment=='0'.toString()">
			and is_payment =0
			</if>
		</where>

	</select>
	 <resultMap id="JournalDetailsMap" type="cn.edu.imut.jm.journal.domain.journal.entity.JournalDetails" >
    <id column="journal_id" property="journalId" jdbcType="INTEGER" />
    <result column="journal_name" property="journalName" jdbcType="VARCHAR" />
    <result column="journal_img" property="journalImg" jdbcType="VARCHAR" />
    <result column="author" property="author" jdbcType="VARCHAR" />
    <result column="journal_level" property="journalLevel" jdbcType="INTEGER" />
    <result column="journal_join_time" property="journalJoinTime" jdbcType="DATE" />
    <result column="publish_time" property="publishTime" jdbcType="DATE" />
    <result column="reel_number" property="reelNumber" jdbcType="INTEGER" />
    <result column="issue" property="issue" jdbcType="VARCHAR" />
    <result column="total_issue" property="totalIssue" jdbcType="INTEGER" />
    <result column="CN" property="cn" jdbcType="VARCHAR" />
    <result column="ISBN" property="isbn" jdbcType="VARCHAR" />
    <result column="ISSN" property="issn" jdbcType="VARCHAR" />
    <result column="publication_cycle" property="publicationCycle" jdbcType="INTEGER" />
    <result column="publishing_house" property="publishingHouse" jdbcType="VARCHAR" />
    <result column="journal_host" property="journalHost" jdbcType="VARCHAR" />
    <result column="is_foreign" property="isForeign" jdbcType="BIT" />
    <result column="publishing_area" property="publishingArea" jdbcType="INTEGER" />
    <result column="jounal_language" property="jounalLanguage" jdbcType="INTEGER" />
    <result column="foreign_codes" property="foreignCodes" jdbcType="VARCHAR" />
    <result column="domestic_code" property="domesticCode" jdbcType="VARCHAR" />
    <result column="format" property="format" jdbcType="INTEGER" />
    <result column="page_number" property="pageNumber" jdbcType="INTEGER" />
    <result column="is_borrow" property="isBorrow" jdbcType="BIT" />
    <result column="price" property="price" jdbcType="DECIMAL" />
    <result column="is_delete" property="isDelete" jdbcType="BIT" />
    <result column="type_id" property="typeId" jdbcType="INTEGER" />
    <result column="journal_type" property="journalType" jdbcType="VARCHAR" />
  </resultMap>
	<select id="selectJournal" parameterType="int" resultMap="JournalDetailsMap">
		select journal_id, journal_name, journal_img, issue,
		total_issue, CN, ISBN, ISSN,
		publishing_house,
		journal_host from
		journal_details where journal_id=#{journalId,jdbcType=INTEGER}
	</select>
	<!--创建借阅记录 -->
	<insert id="insertBorrow"
		parameterType="cn.edu.imut.jm.journal.domain.borrow.entity.Borrow">
		insert into borrow
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="borrowId != null">
				borrow_id,
			</if>
			<if test="borrowTime != null">
				borrow_time,
			</if>
			<if test="returnTime != null">
				return_time,
			</if>
			<if test="realityDays != null">
				reality_days,
			</if>
			<if test="isOverdue != null">
				is_overdue,
			</if>
			<if test="overdueDays != null">
				overdue_days,
			</if>
			<if test="penalty != null">
				penalty,
			</if>
			<if test="isPayment != null">
				is_payment,
			</if>
			<if test="isDelete != null">
				is_delete,
			</if>
			<if test="userId != null">
				user_id,
			</if>
			<if test="journalId != null">
				journal_id,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="borrowId != null">
				#{borrowId,jdbcType=INTEGER},
			</if>
			<if test="borrowTime != null">
				#{borrowTime,jdbcType=DATE},
			</if>
			<if test="returnTime != null">
				#{returnTime,jdbcType=DATE},
			</if>
			<if test="realityDays != null">
				#{realityDays,jdbcType=INTEGER},
			</if>
			<if test="isOverdue != null">
				#{isOverdue,jdbcType=TINYINT},
			</if>
			<if test="overdueDays != null">
				#{overdueDays,jdbcType=INTEGER},
			</if>
			<if test="penalty != null">
				#{penalty,jdbcType=DECIMAL},
			</if>
			<if test="isPayment != null">
				#{isPayment,jdbcType=TINYINT},
			</if>
			<if test="isDelete != null">
				#{isDelete,jdbcType=TINYINT},
			</if>
			<if test="userId != null">
				#{userId,jdbcType=INTEGER},
			</if>
			<if test="journalId != null">
				#{journalId,jdbcType=INTEGER},
			</if>
		</trim>
	</insert>
</mapper>